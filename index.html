<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz-Box Challenge - QWERTY Edition</title>
    <style>
        /* --- CSS STYLES --- */
        body { font-family: Arial, sans-serif; text-align: center; position: relative; min-height: 100vh; background-color: #f4f4f9; }
        h1 { color: #030E26; }
        p { color: #333; }
        .grid { display: grid; grid-template-columns: repeat(5, 60px); gap: 5px; justify-content: center; margin-top: 20px; }
        
        .cell { 
            width: 60px; height: 60px; background: #99BFFF; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; cursor: pointer; border: 2px solid #548FF7;
            color: #030E26; font-weight: bold;
            transition: transform 0.3s ease, background 0.3s ease; 
            perspective: 1000px; 
        }
        .cell:hover { background: #7ba9ff; }
        .cell-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .cell.revealed .cell-inner {
            transform: rotateY(180deg);
        }
        .cell-front, .cell-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cell-back {
            transform: rotateY(180deg);
            background: lightgreen;
        }
        .cell.mine .cell-back { background: red; }

        .end-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); color: white; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; transition: opacity 0.5s ease-in-out; 
        }
        .end-screen.hidden { display: none; opacity: 0; }
        .end-screen h2 { font-size: 32px; font-weight: bold; text-transform: uppercase; animation: fadeIn 1s ease; }

        #resetContainer { margin-top: 20px; }

        #resetButton { 
            padding: 12px 24px; font-size: 18px; 
            cursor: pointer; background: #548FF7; color: white; border: none; 
            border-radius: 5px; font-weight: bold; transition: 0.3s ease;
        }
        #resetButton:hover { background: #030E26; }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <h1>Quiz-Box Challenge - QWERTY Edition</h1>
    <p>Find the safe boxes! Use your mouse or the keys **Q** through **N** (QWERTY order).</p>
    <p id="status">Current Points: 10 | Multiplier: x1.0</p>
    
    <div class="grid" id="grid"></div>

    <div id="resetContainer">
        <button id="resetButton">Start New Game / Reset</button>
    </div>

    <div id="endScreen" class="end-screen hidden">
        <h2 id="endMessage"></h2>
        <p id="finalScore"></p>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIC --- */
        const gridSize = 5;
        const qwertyMap = 'QWERTYUIOPASDFGHJKLZXCVBN';
        const initialPoints = 10;
        
        let currentPoints;
        let mineIndex;
        let revealedCells = 0;
        let gameEnded = false;
        
        // Advanced Money System Variables
        let currentMultiplier = 1; 
        const multiplierIncrease = 0.2; 
        const basePointRange = [2, 4]; 

        function generateMine() {
            mineIndex = Math.floor(Math.random() * (gridSize * gridSize));
        }

        function createGrid() {
            const grid = document.getElementById("grid");
            grid.innerHTML = "";
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement("div");
                cell.classList.add("cell");
                cell.dataset.index = i;

                const cellInner = document.createElement("div");
                cellInner.classList.add("cell-inner");

                const cellFront = document.createElement("div");
                cellFront.classList.add("cell-front");
                cellFront.innerText = qwertyMap[i]; 
                
                const cellBack = document.createElement("div");
                cellBack.classList.add("cell-back");
                cellBack.innerHTML = (i === mineIndex) ? 'üí£' : '‚≠ê'; 

                cellInner.appendChild(cellFront);
                cellInner.appendChild(cellBack);
                cell.appendChild(cellInner);

                cell.addEventListener("click", () => revealCell(i));
                grid.appendChild(cell);
            }
        }

        function updateStatus() {
            document.getElementById("status").innerText = `Current Points: ${currentPoints} | Multiplier: x${currentMultiplier.toFixed(1)}`;
        }

        function revealCell(index) {
            if (gameEnded) return;
            
            const cell = document.querySelector(`.cell[data-index='${index}']`);
            if (!cell || cell.classList.contains("revealed")) return;

            cell.classList.add("revealed");

            if (index === mineIndex) {
                // MINE HIT: Lose points, reset multiplier, END GAME
                const penalty = Math.max(5, Math.floor(currentPoints / 2)); 
                currentPoints -= penalty;
                currentMultiplier = 1; 
                
                cell.classList.add("mine");
                updateStatus();
                
                // Immediately end the game and show the end screen after hitting the mine
                document.getElementById("endMessage").innerText = "üí• Boom! You hit the mine!";
                document.getElementById("finalScore").innerText = `Points Lost: ${penalty}. Final Score: ${currentPoints}`;
                document.getElementById("endScreen").classList.remove("hidden");
                gameEnded = true;
                freezeBoard();
                
                // Only check for points depletion if the player didn't already run out
                if (currentPoints <= 0) {
                    checkEndGame(true);
                }
            } else {
                // SAFE CLICK: Variable reward + multiplier increase
                const basePoints = Math.floor(Math.random() * (basePointRange[1] - basePointRange[0] + 1)) + basePointRange[0];
                const earnedPoints = Math.floor(basePoints * currentMultiplier);
                
                currentPoints += earnedPoints;
                revealedCells++;
                currentMultiplier += multiplierIncrease;
                
                updateStatus();
                checkVictory();
            }
        }

        function freezeBoard() {
            document.querySelectorAll(".cell").forEach(cell => cell.style.pointerEvents = "none");
        }

        function checkVictory() {
            if (revealedCells === gridSize * gridSize - 1) {
                document.getElementById("endMessage").innerText = "üèÜ Victory! All Safe Boxes Found!";
                document.getElementById("finalScore").innerText = `Final Score: ${currentPoints} (Multiplier: x${currentMultiplier.toFixed(1)})`;
                document.getElementById("endScreen").classList.remove("hidden");
                gameEnded = true;
                freezeBoard();
            }
        }

        // Modified checkEndGame to handle the case where points drop to 0 after mine hit
        function checkEndGame(wasMineHit = false) {
            if (currentPoints <= 0) {
                document.getElementById("endMessage").innerText = "üí• Game Over! You ran out of points.";
                document.getElementById("finalScore").innerText = `Final Score: ${currentPoints}`;
                document.getElementById("endScreen").classList.remove("hidden");
                gameEnded = true;
                freezeBoard();
            } else if (wasMineHit) {
                // If mine was hit but points > 0, the game still ends, using the mine end screen message
            }
        }

        function resetGame() {
            currentPoints = initialPoints; 
            revealedCells = 0;
            gameEnded = false;
            currentMultiplier = 1; 
            generateMine();
            createGrid();
            updateStatus();
            document.getElementById("endScreen").classList.add("hidden");
            document.querySelectorAll(".cell").forEach(cell => cell.style.pointerEvents = "auto");
        }
        
        // --- Keyboard Input Feature (QWERTY Map) ---
        document.addEventListener('keydown', (event) => {
            if (gameEnded) return;
            
            const key = event.key.toUpperCase();
            const index = qwertyMap.indexOf(key); 

            if (index !== -1) {
                const cell = document.querySelector(`.cell[data-index='${index}']`);
                if (cell && !cell.classList.contains("revealed")) {
                     revealCell(index);
                }
            }
        });

        document.getElementById("resetButton").addEventListener("click", resetGame);

        // Initial setup
        resetGame(); 
    </script>
</body>
</html>
